<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="SKA : The Static Kernel Analyzer (SKA)" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>SKA</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/tuxfan/ska">View on GitHub</a>

          <h1 id="project_title">SKA</h1>
          <h2 id="project_tagline">The Static Kernel Analyzer (SKA)</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/tuxfan/ska/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/tuxfan/ska/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>What is SKA?</h1>

<p>The <em>static kernel analyzer (SKA)</em> combines a static, linear
pipeline simulator (similar to the IBM <em>spu_timing</em> tool)
with architectural heuristics to model in-order
instruction issue and pipeline behavior.  Pipeline simulations take as
input the <em>intermediate representation (IR)</em> from
<em>Low-Level Virtual Machine (LLVM)</em>.
LLVM and LLVM IR are adopted
standards in the HPC community,
allowing SKA to support a wide range of source inputs.  SKA also has
support for the upcoming OpenCL
<em>Standard Portable Intermediate Representation (SPIR)</em>, which is
based on LLVM IR version 3.1.  Support for OpenCL kernel source
input (in the form of SPIR) allows SKA to model a rich variety of
important modern computing architectures, and provides users with a
new paradigm for application optimization and design.</p>

<p>The underlying hardware properties accessed by SKA during pipeline
simulation are user-defined, allowing for both modeling of existing
processors, and experimentation with novel resource provisioning.  Thus,
SKA can be employed either as an analysis tool for code optimization, or
as a co-design tool to aid in the creation of new processor
configurations.</p>

<p>Users can visualize the output of SKA pipeline
simulations with the <em>skaview</em> program.  The novel view representations in skaview give
the user both detailed clock-for-clock execution information, as well as
intuitive <em>slope</em> and <em>graph</em> views for high-level detection of serious data
and structural hazards.</p>

<h1>Pipeline Simulator</h1>

<p>The primary functionality of ska is as a pipeline simulator of LLVM IR.  The below image shows the an annotated screen shot from skaview:</p>

<p><img src="http://tuxfan.github.com/ska/images/pipeline.png" alt="Pipeline Simulation Detail"></p>

<p>From left to right, this images shows the issue cycle of each instruction, the logic unit on which it executed (including multiple issue flags: D indicates dual-issue), the pipeline progress (dashes represent stalls) and the LLVM IR instruction that was executed.</p>

<h1>Generating Simulations</h1>

<p>To create output suitable for viewing in skaview, begin with the source file that you wish to analyze.  In this example, we use a simple <em>saxpy</em> update:</p>

<div class="highlight"><pre><span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="p">}</span> <span class="c1">// for</span>
</pre></div>

<p>Use the <em>skair</em> script on your source file to generate LLVM IR:</p>

<p>% skair saxpy.c</p>

<p>The <em>skair</em> script is just a wrapper for one of the GNU compilers (gcc, g++ or gfortran) with added flags to use the <a href="http://dragonegg.llvm.org">dragonegg</a> plugin, so you can add any flags that you need to compile your code, e.g.,</p>

<p>% skair -O3 -I/usr/include/special -DMY_DEFINE=defined -Wall -msse saxpy.c</p>

<p>will just pass the extra flags onto the compiler.</p>

<p>The skair script outputs LLVM IR suitable for input into <em>ska</em> (the actual simulator executable).  The IR looks like this:</p>

<div class="highlight"><pre><span class="c">; ModuleID = 'saxpy.c'</span>
<span class="k">target</span> <span class="k">datalayout</span> <span class="p">=</span> <span class="s">"e-p:64:64:64-S128-i1:8:8-i8:8:8-i16:16:16-i32:32:32-i64:64:64-f16:16:16-f32:32:32-f64:64:64-f128:128:128-v64:64:64-v128:128:128-a0:0:64-s0:64:64-f80:128:128-n8:16:32:64"</span>
<span class="k">target</span> <span class="k">triple</span> <span class="p">=</span> <span class="s">"x86_64-apple-darwin11"</span>

<span class="k">define</span> <span class="kt">void</span> <span class="vg">@saxpy</span><span class="p">(</span><span class="k">i32</span> <span class="nv">%n</span><span class="p">,</span> <span class="kt">float</span> <span class="nv">%alpha</span><span class="p">,</span> <span class="kt">float</span><span class="p">*</span> <span class="k">nocapture</span> <span class="nv">%x</span><span class="p">,</span> <span class="kt">float</span><span class="p">*</span> <span class="k">nocapture</span> <span class="nv">%y</span><span class="p">)</span> <span class="k">nounwind</span> <span class="err">uwtable</span> <span class="p">{</span>
<span class="nl">entry:</span>
  <span class="nv-Anonymous">%0</span> <span class="p">=</span> <span class="k">icmp</span> <span class="k">sgt</span> <span class="k">i32</span> <span class="nv">%n</span><span class="p">,</span> <span class="m">0</span>
  <span class="k">br</span> <span class="k">i1</span> <span class="nv-Anonymous">%0</span><span class="p">,</span> <span class="kt">label</span> <span class="nv">%"3.lr.ph"</span><span class="p">,</span> <span class="kt">label</span> <span class="nv">%return</span>

<span class="nl">"3.lr.ph":</span>                                        <span class="c">; preds = %entry</span>
  <span class="nv-Anonymous">%1</span> <span class="p">=</span> <span class="k">bitcast</span> <span class="kt">float</span><span class="p">*</span> <span class="nv">%y</span> <span class="k">to</span> <span class="k">i8</span><span class="p">*</span>
  <span class="nv-Anonymous">%2</span> <span class="p">=</span> <span class="k">bitcast</span> <span class="kt">float</span><span class="p">*</span> <span class="nv">%x</span> <span class="k">to</span> <span class="k">i8</span><span class="p">*</span>
  <span class="k">br</span> <span class="kt">label</span> <span class="nv">%"3"</span>

<span class="nl">"3":</span>                                              <span class="c">; preds = %"3", %"3.lr.ph"</span>
  <span class="nv">%indvars.iv</span> <span class="p">=</span> <span class="k">phi</span> <span class="k">i64</span> <span class="p">[</span> <span class="m">0</span><span class="p">,</span> <span class="nv">%"3.lr.ph"</span> <span class="p">],</span> <span class="p">[</span> <span class="nv">%indvars.iv.next</span><span class="p">,</span> <span class="nv">%"3"</span> <span class="p">]</span>
  <span class="nv-Anonymous">%3</span> <span class="p">=</span> <span class="k">shl</span> <span class="k">nsw</span> <span class="k">i64</span> <span class="nv">%indvars.iv</span><span class="p">,</span> <span class="m">2</span>
  <span class="nv-Anonymous">%4</span> <span class="p">=</span> <span class="k">getelementptr</span> <span class="k">inbounds</span> <span class="k">i8</span><span class="p">*</span> <span class="nv-Anonymous">%1</span><span class="p">,</span> <span class="k">i64</span> <span class="nv-Anonymous">%3</span>
  <span class="nv-Anonymous">%5</span> <span class="p">=</span> <span class="k">getelementptr</span> <span class="k">inbounds</span> <span class="k">i8</span><span class="p">*</span> <span class="nv-Anonymous">%2</span><span class="p">,</span> <span class="k">i64</span> <span class="nv-Anonymous">%3</span>
  <span class="nv-Anonymous">%6</span> <span class="p">=</span> <span class="k">bitcast</span> <span class="k">i8</span><span class="p">*</span> <span class="nv-Anonymous">%5</span> <span class="k">to</span> <span class="kt">float</span><span class="p">*</span>
  <span class="nv-Anonymous">%7</span> <span class="p">=</span> <span class="k">load</span> <span class="kt">float</span><span class="p">*</span> <span class="nv-Anonymous">%6</span><span class="p">,</span> <span class="k">align</span> <span class="m">4</span><span class="p">,</span> <span class="nv">!tbaa</span> <span class="nv-Anonymous">!0</span>
  <span class="nv-Anonymous">%8</span> <span class="p">=</span> <span class="k">fmul</span> <span class="kt">float</span> <span class="nv-Anonymous">%7</span><span class="p">,</span> <span class="nv">%alpha</span>
  <span class="nv-Anonymous">%9</span> <span class="p">=</span> <span class="k">bitcast</span> <span class="k">i8</span><span class="p">*</span> <span class="nv-Anonymous">%4</span> <span class="k">to</span> <span class="kt">float</span><span class="p">*</span>
  <span class="nv-Anonymous">%10</span> <span class="p">=</span> <span class="k">load</span> <span class="kt">float</span><span class="p">*</span> <span class="nv-Anonymous">%9</span><span class="p">,</span> <span class="k">align</span> <span class="m">4</span><span class="p">,</span> <span class="nv">!tbaa</span> <span class="nv-Anonymous">!0</span>
  <span class="nv-Anonymous">%11</span> <span class="p">=</span> <span class="k">fadd</span> <span class="kt">float</span> <span class="nv-Anonymous">%8</span><span class="p">,</span> <span class="nv-Anonymous">%10</span>
  <span class="k">store</span> <span class="kt">float</span> <span class="nv-Anonymous">%11</span><span class="p">,</span> <span class="kt">float</span><span class="p">*</span> <span class="nv-Anonymous">%9</span><span class="p">,</span> <span class="k">align</span> <span class="m">4</span><span class="p">,</span> <span class="nv">!tbaa</span> <span class="nv-Anonymous">!0</span>
  <span class="nv">%indvars.iv.next</span> <span class="p">=</span> <span class="k">add</span> <span class="k">i64</span> <span class="nv">%indvars.iv</span><span class="p">,</span> <span class="m">1</span>
  <span class="nv">%lftr.wideiv</span> <span class="p">=</span> <span class="k">trunc</span> <span class="k">i64</span> <span class="nv">%indvars.iv.next</span> <span class="k">to</span> <span class="k">i32</span>
  <span class="nv">%exitcond</span> <span class="p">=</span> <span class="k">icmp</span> <span class="k">eq</span> <span class="k">i32</span> <span class="nv">%lftr.wideiv</span><span class="p">,</span> <span class="nv">%n</span>
  <span class="k">br</span> <span class="k">i1</span> <span class="nv">%exitcond</span><span class="p">,</span> <span class="kt">label</span> <span class="nv">%return</span><span class="p">,</span> <span class="kt">label</span> <span class="nv">%"3"</span>

<span class="nl">return:</span>                                           <span class="c">; preds = %"3", %entry</span>
  <span class="k">ret</span> <span class="kt">void</span>
<span class="p">}</span>

<span class="nv-Anonymous">!0</span> <span class="p">=</span> <span class="kt">metadata</span> <span class="p">!{</span><span class="kt">metadata</span> <span class="nv">!"alias set 7: float"</span><span class="p">,</span> <span class="kt">metadata</span> <span class="nv-Anonymous">!1</span><span class="p">}</span>
<span class="nv-Anonymous">!1</span> <span class="p">=</span> <span class="kt">metadata</span> <span class="p">!{</span><span class="kt">metadata</span> <span class="nv-Anonymous">!1</span><span class="p">}</span>
</pre></div>

<p>To generate a simulation, call ska with the LLVM IR:</p>

<p>% ska -o saxpy.ska k10.xml saxpy.ll</p>

<p>This command tells ska to output the simulation to <em>saxpy.ska</em> using AMD's K10 architecture (Supported architectures are in the <em>architectures</em> subdirectory of the main project.)  Once you have generated an output file, you can view it with skaview:</p>

<p>% skaview saxpy.ska</p>

<h1>Slope View</h1>

<p>For a complete, more intuitive view of potential stalls in the pipeline, skaview offers a <em>slope</em> view.  The images below show the main window, and the main window with the slope view window opened:</p>

<p><img src="http://tuxfan.github.com/ska/images/main.png" alt="Main Window"></p>

<p><img src="http://tuxfan.github.com/ska/images/slope.png" alt="Main Window w/ Slope View"></p>

<p>The slope view plots the pipeline progress as a single-valued function, with a point at the first execution cycle of each instruction.  Longer stalls will have nearly zero slope, while multiple issue sections (best) will have up to <em>-(max issue)</em>.</p>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">SKA maintained by <a href="https://github.com/tuxfan">tuxfan</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
